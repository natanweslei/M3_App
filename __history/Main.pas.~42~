unit Main;

interface

uses
  Windows,
  Messages,
  SysUtils,
  Variants,
  Classes,
  Graphics,
  Controls,
  Forms,
  uniGUITypes,
  uniGUIAbstractClasses,
  uniGUIClasses,
  uniGUIRegClasses,
  uniGUIForm,
  uniPanel,
  uniPageControl,
  uniGUIBaseClasses,
  uniTreeView,
  Vcl.Imaging.pngimage,
  uniImage,
  uniGUIFrame,
  Vcl.Menus,
  uniMainMenu,
  uniImageList,
  uniTreeMenu;

type
  TMainForm = class(TUniForm)
    UniPageControl1: TUniPageControl;
    UniTabSheet1: TUniTabSheet;
    UniImage1: TUniImage;
    UniMenuItems1: TUniMenuItems;
    UniTreeMenu1: TUniTreeMenu;
    Empresa: TUniMenuItem;
    Funcionario: TUniMenuItem;
    TipoGasto: TUniMenuItem;
    Veiculo: TUniMenuItem;
    Cliente: TUniMenuItem;
    procedure AbrirFormularioClick(Sender: TObject);
  private
  public
    Procedure OpenFrame(AClassName: string; ACaption: string);
  end;

function MainForm: TMainForm;

implementation

{$R *.dfm}

uses
  uniGUIVars,
  MainModule,
  uniGUIApplication;

function MainForm: TMainForm;
begin
  Result := TMainForm(UniMainModule.GetFormInstance(TMainForm));
end;

procedure TMainForm.AbrirFormularioClick(Sender: TObject);
var
  LClassName : string;
begin
  if UniMenuItems1.Items.Name = 'Empresa' then
    LClassName := 'TFormEmpresa'
  else if UniMenuItems1.Name = 'Funcionario' then
     LClassName := 'TFormFuncionario'
  else if UniMenuItems1.Name = 'TipoGasto' then
     LClassName := 'TFormTipoGasto'
  else if UniMenuItems1.Name = 'Veiculo' then
     LClassName := 'TFormVeiculo'
  else if UniMenuItems1.Name = 'Cliente' then
     LClassName := 'TFormCliente';

  OpenFrame(LClassName, UniMenuItems1.Name);
end;

procedure TMainForm.OpenFrame(AClassName: string; ACaption: string);
var
  i: Integer;
  LTabSheet: TUniTabSheet;
  ActivePage_id: integer;
  LFrameClass: TUniFrameClass;
  LFrame: TUniFrame;
begin
  if AClassName = EmptyStr then
    Exit;

  ActivePage_id := -1;

  for i := 0 to UniPageControl1.PageCount -1 do
  begin
    if UniPageControl1.Pages[i].Caption = ACaption then
    begin
      UniPageControl1.ActivePageIndex := i;
      ActivePage_id := 0;
      Break;
    end;
  end;

  if ActivePage_id = -1 then
  begin
    LTabSheet := TUniTabSheet.Create(Self);
    LTabSheet.Closable := True;
    LTabSheet.PageControl := UniPageControl1;
    LTabSheet.Tag := Tag;
    UniPageControl1.ActivePage := LTabSheet;

    LFrameClass := TUniFrameClass(FindClass(AClassName));
    LFrame := LFrameClass.Create(LTabSheet);
    LTabSheet.Caption := LFrame.Hint;
    LFrame.Align := alClient;
    LFrame.Parent := LTabSheet;
  end;
end;

initialization
  RegisterAppFormClass(TMainForm);

end.
